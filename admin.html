<!DOCTYPE html>
<html lang="kk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin –ø–∞–Ω–µ–ª—ñ | QosQanat</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container navbar-container">
            <a href="admin.html" class="navbar-brand">
                <img src="../assets/images/logo.png" alt="QosQanat">
                <span>QosQanat Admin</span>
            </a>

            <button onclick="adminLogout()" class="btn btn-sm btn-outline" style="color: white; border-color: white;">
                –®—ã“ì—É
            </button>
        </div>
    </nav>

    <div class="container py-lg">
        <h1 class="text-center mb-xl animate-fade-in">‚öôÔ∏è Admin –ø–∞–Ω–µ–ª—ñ</h1>

        <!-- Stats Dashboard -->
        <div class="grid grid-4 mb-xl">
            <div class="card stat-card animate-fade-in-up"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body text-center">
                    <div style="font-size: 40px; margin-bottom: 10px;">üë•</div>
                    <h3 id="total-users">0</h3>
                    <p style="opacity: 0.9;">–û“õ—É—à—ã–ª–∞—Ä</p>
                </div>
            </div>

            <div class="card stat-card animate-fade-in-up"
                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                <div class="card-body text-center">
                    <div style="font-size: 40px; margin-bottom: 10px;">üì∞</div>
                    <h3 id="total-news">0</h3>
                    <p style="opacity: 0.9;">–ñ–∞“£–∞–ª—ã“õ—Ç–∞—Ä</p>
                </div>
            </div>

            <div class="card stat-card animate-fade-in-up"
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                <div class="card-body text-center">
                    <div style="font-size: 40px; margin-bottom: 10px;">‚úÖ</div>
                    <h3 id="total-completed">0</h3>
                    <p style="opacity: 0.9;">–®—ã“ì–∞—Ä—ã–ª“ì–∞–Ω –µ—Å–µ–ø—Ç–µ—Ä</p>
                </div>
            </div>

            <div class="card stat-card animate-fade-in-up"
                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                <div class="card-body text-center">
                    <div style="font-size: 40px; margin-bottom: 10px;">üë®‚Äçüíº</div>
                    <h3 id="total-admins">1</h3>
                    <p style="opacity: 0.9;">Admin–¥–µ—Ä</p>
                </div>
            </div>
        </div>

        <!-- Admin Tabs -->
        <div class="admin-tabs mb-lg">
            <button class="admin-tab active" onclick="switchAdminTab('news')">üì∞ –ñ–∞“£–∞–ª—ã“õ—Ç–∞—Ä</button>
            <button class="admin-tab" onclick="switchAdminTab('users')">üë• –û“õ—É—à—ã–ª–∞—Ä</button>
            <button class="admin-tab" onclick="switchAdminTab('admins')">üë®‚Äçüíº Admin–¥–µ—Ä</button>
        </div>

        <!-- News Management Tab -->
        <div id="news-tab" class="admin-tab-content">
            <div class="card mb-lg">
                <div class="card-body">
                    <h3 class="mb-lg">‚ûï –ñ–∞“£–∞ –∂–∞“£–∞–ª—ã“õ –∂–∞—Å–∞—É</h3>

                    <div class="form-group">
                        <label>–¢–∞“õ—ã—Ä—ã–ø:</label>
                        <input type="text" class="form-control" id="news-title" placeholder="–ñ–∞“£–∞–ª—ã“õ —Ç–∞“õ—ã—Ä—ã–±—ã">
                    </div>

                    <div class="form-group">
                        <label>“ö—ã—Å“õ–∞—à–∞ —Å–∏–ø–∞—Ç—Ç–∞–º–∞:</label>
                        <textarea class="form-control" id="news-short" rows="2" placeholder="200 —Å–∏–º–≤–æ–ª“ì–∞ –¥–µ–π—ñ–Ω"
                            maxlength="200"></textarea>
                    </div>

                    <div class="form-group">
                        <label>–¢–æ–ª—ã“õ —Å–∏–ø–∞—Ç—Ç–∞–º–∞:</label>
                        <textarea class="form-control" id="news-full" rows="5" placeholder="–¢–æ–ª—ã“õ –º–∞–∑–º“±–Ω—ã"></textarea>
                    </div>

                    <div class="form-group">
                        <label>–°—É—Ä–µ—Ç URL:</label>
                        <input type="text" class="form-control" id="news-image"
                            placeholder="https://example.com/image.jpg">
                        <small class="text-muted">–ù–µ–º–µ—Å–µ placeholder —Å—É—Ä–µ—Ç –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã</small>
                    </div>

                    <button class="btn btn-primary btn-lg" onclick="createNews()">
                        –ñ–∞“£–∞–ª—ã“õ –∂–∞—Å–∞—É
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h3 class="mb-lg">üìã –ë–∞—Ä–ª—ã“õ –∂–∞“£–∞–ª—ã“õ—Ç–∞—Ä</h3>
                    <div id="news-list"></div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="admin-tab-content" style="display: none;">
            <div class="card">
                <div class="card-body">
                    <h3 class="mb-lg">üë• –¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –æ“õ—É—à—ã–ª–∞—Ä</h3>
                    <div id="users-list"></div>
                </div>
            </div>
        </div>

        <!-- Admins Tab -->
        <div id="admins-tab" class="admin-tab-content" style="display: none;">
            <div class="card mb-lg">
                <div class="card-body">
                    <h3 class="mb-lg">‚ûï –ñ–∞“£–∞ admin “õ–æ—Å—É</h3>

                    <div class="grid grid-2">
                        <div class="form-group">
                            <label>–ê—Ç—ã-–∂”©–Ω—ñ:</label>
                            <input type="text" class="form-control" id="admin-name" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ">
                        </div>

                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                            <input type="text" class="form-control" id="admin-phone" placeholder="87012345678">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>“ö“±–ø–∏—è —Å”©–∑:</label>
                        <input type="password" class="form-control" id="admin-password"
                            placeholder="–ö–µ–º –¥–µ–≥–µ–Ω–¥–µ 6 —Å–∏–º–≤–æ–ª">
                    </div>

                    <button class="btn btn-primary" onclick="addAdmin()">
                        Admin “õ–æ—Å—É
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h3 class="mb-lg">üë®‚Äçüíº –ë–∞—Ä–ª—ã“õ admin–¥–µ—Ä</h3>
                    <div id="admins-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script>
        // Check admin authentication
        const user = getCurrentUser();
        if (!user || user.role !== 'admin') {
            // Not an admin, redirect to login
            showToast('error', '–¢–µ–∫ admin–¥–µ—Ä–≥–µ —Ä“±“õ—Å–∞—Ç!');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        // Mock data (replace with API calls)
        let newsList = JSON.parse(localStorage.getItem('admin-news') || '[]');
        let adminsList = [
            { id: '1', fullName: 'QosQanat Admin', phone: '87713399824', createdAt: '2026-02-01' }
        ];

        // Load initial stats
        loadDashboardStats();
        loadNewsList();

        function loadDashboardStats() {
            // Mock stats (replace with API call)
            const completedProblems = JSON.parse(localStorage.getItem('completedProblems') || '[]');

            document.getElementById('total-users').textContent = '5';
            document.getElementById('total-news').textContent = newsList.length;
            document.getElementById('total-completed').textContent = completedProblems.length;
            document.getElementById('total-admins').textContent = adminsList.length;
        }

        function switchAdminTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all tabs
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Show selected tab
            if (tab === 'news') {
                document.getElementById('news-tab').style.display = 'block';
                loadNewsList();
            } else if (tab === 'users') {
                document.getElementById('users-tab').style.display = 'block';
                loadUsersList();
            } else if (tab === 'admins') {
                document.getElementById('admins-tab').style.display = 'block';
                loadAdminsList();
            }
        }

        function createNews() {
            const title = document.getElementById('news-title').value.trim();
            const shortDesc = document.getElementById('news-short').value.trim();
            const fullDesc = document.getElementById('news-full').value.trim();
            const image = document.getElementById('news-image').value.trim() ||
                'https://via.placeholder.com/400x200/667eea/ffffff?text=QosQanat';

            if (!title || !shortDesc || !fullDesc) {
                showToast('error', '–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!');
                return;
            }

            const newsItem = {
                id: Date.now().toString(),
                title,
                shortDescription: shortDesc,
                fullDescription: fullDesc,
                image,
                createdAt: new Date().toISOString().split('T')[0],
                createdBy: user.fullName || 'Admin'
            };

            newsList.unshift(newsItem);
            localStorage.setItem('admin-news', JSON.stringify(newsList));

            // Clear form
            document.getElementById('news-title').value = '';
            document.getElementById('news-short').value = '';
            document.getElementById('news-full').value = '';
            document.getElementById('news-image').value = '';

            showToast('success', '–ñ–∞“£–∞–ª—ã“õ –∂–∞—Ä–∏—è–ª–∞–Ω–¥—ã!');
            loadNewsList();
            loadDashboardStats();
        }

        function loadNewsList() {
            const container = document.getElementById('news-list');

            if (newsList.length === 0) {
                container.innerHTML = '<div class="alert alert-info">”ò–ª—ñ –∂–∞“£–∞–ª—ã“õ—Ç–∞—Ä –∂–æ“õ</div>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table">';
            html += `
                <thead>
                    <tr>
                        <th>–¢–∞“õ—ã—Ä—ã–ø</th>
                        <th>–ö“Ø–Ω—ñ</th>
                        <th>”ò—Ä–µ–∫–µ—Ç</th>
                    </tr>
                </thead>
                <tbody>
            `;

            newsList.forEach(news => {
                html += `
                    <tr>
                        <td>
                            <strong>${news.title}</strong><br>
                            <small class="text-muted">${news.shortDescription}</small>
                        </td>
                        <td>${news.createdAt}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteNews('${news.id}')">
                                –ñ–æ—é
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function deleteNews(newsId) {
            if (!confirm('–ñ–∞“£–∞–ª—ã“õ—Ç—ã –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) return;

            newsList = newsList.filter(n => n.id !== newsId);
            localStorage.setItem('admin-news', JSON.stringify(newsList));

            showToast('success', '–ñ–∞“£–∞–ª—ã“õ –∂–æ–π—ã–ª–¥—ã');
            loadNewsList();
            loadDashboardStats();
        }

        function loadUsersList() {
            // Mock user data
            const users = [
                { fullName: '–ê–π–¥–∞—Ä –°–µ—Ä—ñ–∫–±–∞–µ–≤', email: 'aidar@test.kz', city: '–ê—Å—Ç–∞–Ω–∞', school: '‚Ññ1 –ù–ó–ú', grade: 10, level: 4, points: 850 },
                { fullName: '–ñ–∞–Ω–∞—Ä “ö–∞–ª–∏–µ–≤–∞', email: 'zhanar@test.kz', city: '–ê–ª–º–∞—Ç—ã', school: '‚Ññ28 –≥–∏–º–Ω–∞–∑–∏—è—Å—ã', grade: 9, level: 4, points: 720 },
                { fullName: '–ù“±—Ä—Å“±–ª—Ç–∞–Ω ”ò–±–¥—ñ“ì–∞–ª–∏–µ–≤', email: 'nursultan@test.kz', city: '–ê—Å—Ç–∞–Ω–∞', school: '‚Ññ45 –º–µ–∫—Ç–µ–±—ñ', grade: 11, level: 4, points: 950 }
            ];

            let html = '<div class="table-responsive"><table class="table">';
            html += `
                <thead>
                    <tr>
                        <th>–ê—Ç—ã-–∂”©–Ω—ñ</th>
                        <th>Email</th>
                        <th>“ö–∞–ª–∞</th>
                        <th>–ú–µ–∫—Ç–µ–ø</th>
                        <th>–°—ã–Ω—ã–ø</th>
                        <th>–î–µ“£–≥–µ–π</th>
                        <th>“∞–ø–∞–π</th>
                    </tr>
                </thead>
                <tbody>
            `;

            users.forEach(user => {
                html += `
                    <tr>
                        <td>${user.fullName}</td>
                        <td>${user.email}</td>
                        <td>${user.city}</td>
                        <td>${user.school}</td>
                        <td>${user.grade}-—Å—ã–Ω—ã–ø</td>
                        <td><span class="level-badge">‚≠ê ${user.level}</span></td>
                        <td><strong>${user.points}</strong></td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('users-list').innerHTML = html;
        }

        function addAdmin() {
            const name = document.getElementById('admin-name').value.trim();
            const phone = document.getElementById('admin-phone').value.trim();
            const password = document.getElementById('admin-password').value;

            if (!name || !phone || !password) {
                showToast('error', '–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!');
                return;
            }

            if (password.length < 6) {
                showToast('error', '“ö“±–ø–∏—è —Å”©–∑ –∫–µ–º –¥–µ–≥–µ–Ω–¥–µ 6 —Å–∏–º–≤–æ–ª–¥–∞–Ω —Ç“±—Ä—É—ã –∫–µ—Ä–µ–∫!');
                return;
            }

            const admin = {
                id: Date.now().toString(),
                fullName: name,
                phone,
                createdAt: new Date().toISOString().split('T')[0]
            };

            adminsList.push(admin);

            // Clear form
            document.getElementById('admin-name').value = '';
            document.getElementById('admin-phone').value = '';
            document.getElementById('admin-password').value = '';

            showToast('success', 'Admin “õ–æ—Å—ã–ª–¥—ã!');
            loadAdminsList();
            loadDashboardStats();
        }

        function loadAdminsList() {
            let html = '<div class="table-responsive"><table class="table">';
            html += `
                <thead>
                    <tr>
                        <th>–ê—Ç—ã-–∂”©–Ω—ñ</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>“ö–æ—Å—ã–ª“ì–∞–Ω –∫“Ø–Ω—ñ</th>
                        <th>”ò—Ä–µ–∫–µ—Ç</th>
                    </tr>
                </thead>
                <tbody>
            `;

            adminsList.forEach((admin, index) => {
                html += `
                    <tr>
                        <td>${admin.fullName}</td>
                        <td>${admin.phone}</td>
                        <td>${admin.createdAt}</td>
                        <td>
                            ${index !== 0 ? `<button class="btn btn-sm btn-danger" onclick="removeAdmin('${admin.id}')">–ñ–æ—é</button>` : '<span class="text-muted">–ù–µ–≥—ñ–∑–≥—ñ admin</span>'}
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            document.getElementById('admins-list').innerHTML = html;
        }

        function removeAdmin(adminId) {
            if (!confirm('Admin-–¥—ñ –∂–æ—é“ì–∞ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?')) return;

            adminsList = adminsList.filter(a => a.id !== adminId);

            showToast('success', 'Admin –∂–æ–π—ã–ª–¥—ã');
            loadAdminsList();
            loadDashboardStats();
        }

        function adminLogout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    </script>
</body>

</html>