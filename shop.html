<!DOCTYPE html>
<html lang="kk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î“Ø–∫–µ–Ω | QosQanat</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="home.html" class="navbar-brand">
                <img src="../assets/images/logo.png" alt="QosQanat">
                <span>QosQanat</span>
            </a>

            <ul class="navbar-menu">
                <li><a href="home.html" class="navbar-link">–ë–∞—Å—Ç—ã</a></li>
                <li><a href="learning.html" class="navbar-link">–û“õ—É</a></li>
                <li><a href="rating.html" class="navbar-link">–†–µ–π—Ç–∏–Ω–≥</a></li>
                <li><a href="shop.html" class="navbar-link active">–î“Ø–∫–µ–Ω</a></li>
                <li><a href="profile.html" class="navbar-link">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><button onclick="logout()" class="btn btn-sm btn-outline">–®—ã“ì—É</button></li>
            </ul>
        </div>
    </nav>

    <div class="container py-lg">
        <!-- User Coins Display -->
        <div class="card mb-xl animate-fade-in-down"
            style="background: linear-gradient(135deg, #fee140 0%, #fa709a 100%);">
            <div class="card-body text-center">
                <div style="font-size: 60px; margin-bottom: 10px;">ü™ô</div>
                <h2 class="mb-sm">–ú–µ–Ω—ñ“£ Coin-–¥–∞—Ä—ã–º</h2>
                <div style="font-size: 48px; font-weight: bold; color: white;" id="user-coins">20</div>
                <p class="mt-sm" style="color: rgba(255,255,255,0.9);">–î–µ“£–≥–µ–π ”©—Ç–∫–µ–Ω–¥–µ coin –∞–ª–∞—Å—ã–∑!</p>
            </div>
        </div>

        <h1 class="text-center mb-xl animate-fade-in">üõí –î“Ø–∫–µ–Ω</h1>

        <!-- Shop Items Grid -->
        <div class="grid grid-2">
            <!-- Item 1: Glasses -->
            <div class="card shop-item-card animate-fade-in-up">
                <div class="card-body">
                    <div class="shop-item-icon">üï∂Ô∏è</div>
                    <h3 class="shop-item-title">–ö”©–∑—ñ–ª–¥—ñ—Ä—ñ–∫</h3>
                    <p class="shop-item-description">–°—Ç–∏–ª—å–¥—ñ –∫”©–∑—ñ–ª–¥—ñ—Ä—ñ–∫ –∞–≤–∞—Ç–∞—Ä—ã“£—ã–∑“ì–∞!</p>
                    <div class="shop-item-price">
                        <span class="price-amount">50</span>
                        <span class="price-currency">ü™ô coin</span>
                    </div>
                    <button class="btn btn-primary btn-block mt-md" id="btn-glasses"
                        onclick="purchaseItem('glasses', 50)">
                        –°–∞—Ç—ã–ø –∞–ª—É
                    </button>
                    <div id="status-glasses" class="shop-item-status"></div>
                </div>
            </div>

            <!-- Item 2: Hat -->
            <div class="card shop-item-card animate-fade-in-up">
                <div class="card-body">
                    <div class="shop-item-icon">üé©</div>
                    <h3 class="shop-item-title">–ë–∞—Å –∫–∏—ñ–º</h3>
                    <p class="shop-item-description">–°”ô–Ω–¥—ñ –±–∞—Å –∫–∏—ñ–º –∞–≤–∞—Ç–∞—Ä—ã“£—ã–∑“ì–∞!</p>
                    <div class="shop-item-price">
                        <span class="price-amount">70</span>
                        <span class="price-currency">ü™ô coin</span>
                    </div>
                    <button class="btn btn-primary btn-block mt-md" id="btn-hat" onclick="purchaseItem('hat', 70)">
                        –°–∞—Ç—ã–ø –∞–ª—É
                    </button>
                    <div id="status-hat" class="shop-item-status"></div>
                </div>
            </div>

            <!-- Item 3: Gold Background -->
            <div class="card shop-item-card animate-fade-in-up">
                <div class="card-body">
                    <div class="shop-item-icon">‚≠ê</div>
                    <h3 class="shop-item-title">–ê–ª—Ç—ã–Ω —Ñ–æ–Ω</h3>
                    <p class="shop-item-description">–ü—Ä–µ–º–∏—É–º –∞–ª—Ç—ã–Ω —Ñ–æ–Ω –∞–≤–∞—Ç–∞—Ä—ã“£—ã–∑“ì–∞!</p>
                    <div class="shop-item-price">
                        <span class="price-amount">100</span>
                        <span class="price-currency">ü™ô coin</span>
                    </div>
                    <button class="btn btn-primary btn-block mt-md" id="btn-goldBackground"
                        onclick="purchaseItem('goldBackground', 100)">
                        –°–∞—Ç—ã–ø –∞–ª—É
                    </button>
                    <div id="status-goldBackground" class="shop-item-status"></div>
                </div>
            </div>

            <!-- Item 4: Super Costume -->
            <div class="card shop-item-card animate-fade-in-up">
                <div class="card-body">
                    <div class="shop-item-icon">ü¶∏</div>
                    <h3 class="shop-item-title">–°—É–ø–µ—Ä –∫–æ—Å—Ç—é–º</h3>
                    <p class="shop-item-description">–ï—Ä–µ–∫—à–µ —Å—É–ø–µ—Ä –∫–æ—Å—Ç—é–º –∞–≤–∞—Ç–∞—Ä—ã“£—ã–∑“ì–∞!</p>
                    <div class="shop-item-price">
                        <span class="price-amount">150</span>
                        <span class="price-currency">ü™ô coin</span>
                    </div>
                    <button class="btn btn-primary btn-block mt-md" id="btn-superCostume"
                        onclick="purchaseItem('superCostume', 150)">
                        –°–∞—Ç—ã–ø –∞–ª—É
                    </button>
                    <div id="status-superCostume" class="shop-item-status"></div>
                </div>
            </div>
        </div>

        <!-- Avatar Preview Section -->
        <div class="card mt-xl animate-fade-in-up">
            <div class="card-body">
                <h3 class="text-center mb-lg">üëÄ –ê–≤–∞—Ç–∞—Ä –∞–ª–¥—ã–Ω-–∞–ª–∞ “õ–∞—Ä–∞—É</h3>
                <div class="avatar-preview-container">
                    <div class="avatar-preview-large" id="avatar-preview">
                        <img src="../assets/images/bektur.jpg" alt="Avatar" id="preview-avatar-img">
                        <div class="avatar-overlay-items" id="overlay-items"></div>
                    </div>
                    <div class="avatar-preview-items" id="preview-items-list">
                        <p class="text-muted">–°–∞—Ç—ã–ø –∞–ª“ì–∞–Ω –∑–∞—Ç—Ç–∞—Ä—ã“£—ã–∑ –º“±–Ω–¥–∞ –∫”©—Ä—ñ–Ω–µ–¥—ñ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- How to Earn Coins -->
        <div class="card mt-xl animate-fade-in-up"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="card-body text-center">
                <h3 class="mb-md">üí° Coin “õ–∞–ª–∞–π –∂–∏–Ω–∞—É“ì–∞ –±–æ–ª–∞–¥—ã?</h3>
                <div class="grid grid-3" style="color: white;">
                    <div>
                        <div style="font-size: 40px; margin-bottom: 10px;">üìö</div>
                        <h4>–ï—Å–µ–ø —à—ã“ì–∞—Ä</h4>
                        <p style="opacity: 0.9;">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –µ—Å–µ–ø—Ç–µ—Ä—ñ–Ω —à—ã“ì–∞—Ä—ã–ø “±–ø–∞–π –∂–∏–Ω–∞</p>
                    </div>
                    <div>
                        <div style="font-size: 40px; margin-bottom: 10px;">‚¨ÜÔ∏è</div>
                        <h4>–î–µ“£–≥–µ–π ”©—Ç</h4>
                        <p style="opacity: 0.9;">”ò—Ä –∂–∞“£–∞ –¥–µ“£–≥–µ–π–≥–µ ”©—Ç–∫–µ–Ω–¥–µ coin –∞–ª–∞—Å—ã–∑</p>
                    </div>
                    <div>
                        <div style="font-size: 40px; margin-bottom: 10px;">üõí</div>
                        <h4>–ó–∞—Ç —Å–∞—Ç—ã–ø –∞–ª</h4>
                        <p style="opacity: 0.9;">Coin-–¥–∞—Ä—ã“£—ã–∑–¥—ã –¥“Ø–∫–µ–Ω–¥–µ –∂“±–º—Å–∞“£—ã–∑</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script src="../js/gamification.js"></script>
    <script>
        checkAuth();

        // Load user data
        const stats = JSON.parse(localStorage.getItem('userStats') || '{"level":1,"intellectPoints":0,"coins":20}');
        const ownedItems = JSON.parse(localStorage.getItem('ownedItems') || '{"glasses":false,"hat":false,"goldBackground":false,"superCostume":false}');
        const avatar = localStorage.getItem('avatar') || 'bektur';

        // Display coins
        document.getElementById('user-coins').textContent = stats.coins;

        // Set avatar preview
        const avatarImages = {
            'bektur': '../assets/images/bektur.jpg',
            'nazym': '../assets/images/nazym.jpg'
        };
        document.getElementById('preview-avatar-img').src = avatarImages[avatar];

        // Update item statuses
        const itemNames = {
            'glasses': '–ö”©–∑—ñ–ª–¥—ñ—Ä—ñ–∫',
            'hat': '–ë–∞—Å –∫–∏—ñ–º',
            'goldBackground': '–ê–ª—Ç—ã–Ω —Ñ–æ–Ω',
            'superCostume': '–°—É–ø–µ—Ä –∫–æ—Å—Ç—é–º'
        };

        const itemIcons = {
            'glasses': 'üï∂Ô∏è',
            'hat': 'üé©',
            'goldBackground': '‚≠ê',
            'superCostume': 'ü¶∏'
        };

        // Update buttons based on ownership
        Object.keys(ownedItems).forEach(itemId => {
            if (ownedItems[itemId]) {
                const button = document.getElementById(`btn-${itemId}`);
                const status = document.getElementById(`status-${itemId}`);

                button.disabled = true;
                button.textContent = '‚úì –°–∞—Ç—ã–ø –∞–ª—ã–Ω“ì–∞–Ω';
                button.classList.remove('btn-primary');
                button.classList.add('btn-success');

                status.innerHTML = '<div class="alert alert-success mt-md">–°—ñ–∑–¥–µ –±–∞—Ä!</div>';
            }
        });

        // Show owned items in preview
        updatePreview();

        function updatePreview() {
            const ownedList = Object.keys(ownedItems).filter(key => ownedItems[key]);

            if (ownedList.length > 0) {
                let itemsHTML = '<div class="owned-items-preview">';
                ownedList.forEach(item => {
                    itemsHTML += `<div class="preview-item">${itemIcons[item]} ${itemNames[item]}</div>`;
                });
                itemsHTML += '</div>';
                document.getElementById('preview-items-list').innerHTML = itemsHTML;

                // Add visual overlay (simplified)
                let overlayHTML = '';
                if (ownedItems.goldBackground) {
                    overlayHTML += '<div class="avatar-gold-bg"></div>';
                }
                document.getElementById('overlay-items').innerHTML = overlayHTML;
            }
        }

        function purchaseItem(itemId, price) {
            // Check if already owned
            if (ownedItems[itemId]) {
                showToast('info', '–°—ñ–∑ –±“±–ª –∑–∞—Ç—Ç—ã —Å–∞—Ç—ã–ø –∞–ª“ì–∞–Ω—Å—ã–∑!');
                return;
            }

            // Check if enough coins
            if (stats.coins < price) {
                showToast('error', `Coin –∂–µ—Ç–∫—ñ–ª—ñ–∫—Å—ñ–∑! –°—ñ–∑–¥–µ ${stats.coins} coin –±–∞—Ä, –∫–µ—Ä–µ–≥—ñ ${price} coin.`);
                return;
            }

            // Purchase item
            stats.coins -= price;
            ownedItems[itemId] = true;

            // Save to localStorage
            localStorage.setItem('userStats', JSON.stringify(stats));
            localStorage.setItem('ownedItems', JSON.stringify(ownedItems));

            // Update UI
            document.getElementById('user-coins').textContent = stats.coins;

            const button = document.getElementById(`btn-${itemId}`);
            const status = document.getElementById(`status-${itemId}`);

            button.disabled = true;
            button.textContent = '‚úì –°–∞—Ç—ã–ø –∞–ª—ã–Ω“ì–∞–Ω';
            button.classList.remove('btn-primary');
            button.classList.add('btn-success');

            status.innerHTML = '<div class="alert alert-success mt-md animate-bounce-in">–°–∞—Ç—ã–ø –∞–ª—ã–Ω–¥—ã! ‚úì</div>';

            // Update preview
            updatePreview();

            // Show success message
            showToast('success', `${itemNames[itemId]} —Å”ô—Ç—Ç—ñ —Å–∞—Ç—ã–ø –∞–ª—ã–Ω–¥—ã!`);

            // Show celebration
            showPurchaseCelebration(itemIcons[itemId], itemNames[itemId]);
        }

        function showPurchaseCelebration(icon, name) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content animate-bounce-in">
                    <div class="modal-body text-center">
                        <div style="font-size: 100px; margin-bottom: 20px;">${icon}</div>
                        <h2 class="text-primary">“ö“±—Ç—Ç—ã“õ—Ç–∞–π–º—ã–∑!</h2>
                        <p class="text-xl">"${name}" —Å–∞—Ç—ã–ø –∞–ª–¥—ã“£—ã–∑!</p>
                        <p class="text-muted">–ü—Ä–æ—Ñ–∏–ª—å—ñ“£—ñ–∑–¥–µ –∫”©—Ä–µ –∞–ª–∞—Å—ã–∑</p>
                        <button class="btn btn-primary btn-lg mt-lg" onclick="this.closest('.modal').remove()">
                            –ñ–∞—Ä–∞–π–¥—ã
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Auto-close after 3 seconds
            setTimeout(() => {
                if (modal.parentElement) {
                    modal.remove();
                }
            }, 3000);
        }
    </script>
</body>

</html>