<!DOCTYPE html>
<html lang="kk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å | QosQanat</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="home.html" class="navbar-brand">
                <img src="../assets/images/logo.png" alt="QosQanat">
                <span>QosQanat</span>
            </a>

            <ul class="navbar-menu">
                <li><a href="home.html" class="navbar-link">–ë–∞—Å—Ç—ã</a></li>
                <li><a href="learning.html" class="navbar-link">–û“õ—É</a></li>
                <li><a href="rating.html" class="navbar-link">–†–µ–π—Ç–∏–Ω–≥</a></li>
                <li><a href="shop.html" class="navbar-link">–î“Ø–∫–µ–Ω</a></li>
                <li><a href="profile.html" class="navbar-link active">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><button onclick="logout()" class="btn btn-sm btn-outline">–®—ã“ì—É</button></li>
            </ul>
        </div>
    </nav>

    <div class="container py-lg">
        <div class="grid grid-2">
            <!-- Left Column - Avatar and Basic Info -->
            <div>
                <!-- Avatar Card -->
                <div class="card mb-lg animate-fade-in-up">
                    <div class="card-body text-center">
                        <div class="profile-avatar-large" id="profile-avatar">
                            <img src="../assets/images/bektur.jpg" alt="Avatar" id="avatar-img">
                        </div>
                        <h2 class="mt-md" id="user-fullname">–û“õ—É—à—ã</h2>
                        <p class="text-muted" id="user-school">–ú–µ–∫—Ç–µ–ø</p>
                        <button class="btn btn-outline mt-md" onclick="changeAvatar()">–ê–≤–∞—Ç–∞—Ä–¥—ã ”©–∑–≥–µ—Ä—Ç—É</button>
                    </div>
                </div>

                <!-- Stats Card -->
                <div class="card animate-fade-in-up">
                    <div class="card-body">
                        <h3 class="mb-lg">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>

                        <div class="stat-row">
                            <span class="stat-label">‚≠ê –î–µ“£–≥–µ–π:</span>
                            <span class="stat-value" id="stat-level">1</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">üß† –ê“õ—ã–ª “±–ø–∞–π—ã:</span>
                            <span class="stat-value" id="stat-points">0</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">ü™ô Coin:</span>
                            <span class="stat-value" id="stat-coins">20</span>
                        </div>

                        <div class="stat-row">
                            <span class="stat-label">‚úÖ –û—Ä—ã–Ω–¥–∞–ª“ì–∞–Ω –µ—Å–µ–ø—Ç–µ—Ä:</span>
                            <span class="stat-value" id="stat-completed">0</span>
                        </div>

                        <div class="mt-lg">
                            <p class="text-sm text-muted mb-sm">–ö–µ–ª–µ—Å—ñ –¥–µ“£–≥–µ–π–≥–µ –¥–µ–π—ñ–Ω</p>
                            <div class="progress progress-lg">
                                <div class="progress-bar" id="level-progress" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-center mt-sm" id="progress-text">0 / 100 “±–ø–∞–π</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Details and Progress -->
            <div>
                <!-- Personal Info Card -->
                <div class="card mb-lg animate-fade-in-up">
                    <div class="card-body">
                        <h3 class="mb-lg">üë§ –ñ–µ–∫–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä</h3>

                        <div class="form-group">
                            <label>–ê—Ç—ã-–∂”©–Ω—ñ:</label>
                            <input type="text" class="form-control" id="edit-fullname" value="–û“õ—É—à—ã">
                        </div>

                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" class="form-control" id="edit-email" value="student@qosqanat.kz">
                        </div>

                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                            <input type="text" class="form-control" id="edit-phone" value="87012345678" disabled>
                        </div>

                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>“ö–∞–ª–∞:</label>
                                <select class="form-control" id="edit-city">
                                    <option>–ê—Å—Ç–∞–Ω–∞</option>
                                    <option>–ê–ª–º–∞—Ç—ã</option>
                                    <option>–®—ã–º–∫–µ–Ω—Ç</option>
                                    <option>“ö–∞—Ä–∞“ì–∞–Ω–¥—ã</option>
                                    <option>–ê“õ—Ç”©–±–µ</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>–°—ã–Ω—ã–ø:</label>
                                <select class="form-control" id="edit-grade">
                                    <option value="7">7-—Å—ã–Ω—ã–ø</option>
                                    <option value="8">8-—Å—ã–Ω—ã–ø</option>
                                    <option value="9" selected>9-—Å—ã–Ω—ã–ø</option>
                                    <option value="10">10-—Å—ã–Ω—ã–ø</option>
                                    <option value="11">11-—Å—ã–Ω—ã–ø</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>–ú–µ–∫—Ç–µ–ø:</label>
                            <input type="text" class="form-control" id="edit-school" value="‚Ññ1 –º–µ–∫—Ç–µ–±—ñ">
                        </div>

                        <button class="btn btn-primary btn-block mt-lg" onclick="saveProfile()">–°–∞“õ—Ç–∞—É</button>
                    </div>
                </div>

                <!-- Progress by Topics Card -->
                <div class="card animate-fade-in-up">
                    <div class="card-body">
                        <h3 class="mb-lg">üìà –¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>

                        <div class="topic-progress-item">
                            <div class="topic-progress-header">
                                <span>üî¢ –ù–∞—Ç—É—Ä–∞–ª —Å–∞–Ω–¥–∞—Ä</span>
                                <span class="fw-bold" id="progress-count-1">0 / 20</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" id="progress-bar-1" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="topic-progress-item">
                            <div class="topic-progress-header">
                                <span>‚ûó –ë”©–ª—à–µ–∫—Ç–µ—Ä</span>
                                <span class="fw-bold" id="progress-count-2">0 / 20</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" id="progress-bar-2" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="topic-progress-item">
                            <div class="topic-progress-header">
                                <span>üìê –°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É–ª–µ—Ä</span>
                                <span class="fw-bold" id="progress-count-3">0 / 20</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" id="progress-bar-3" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avatar Items Card -->
                <div class="card mt-lg animate-fade-in-up">
                    <div class="card-body">
                        <h3 class="mb-lg">üéÅ –ú–µ–Ω—ñ“£ –∑–∞—Ç—Ç–∞—Ä—ã–º</h3>
                        <div class="avatar-items-grid" id="owned-items">
                            <div class="alert alert-info">–î“Ø–∫–µ–Ω–Ω–µ–Ω –∑–∞—Ç—Ç–∞—Ä —Å–∞—Ç—ã–ø –∞–ª—ã“£—ã–∑!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script src="../js/gamification.js"></script>
    <script>
        checkAuth();

        // Load user data
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const stats = JSON.parse(localStorage.getItem('userStats') || '{"level":1,"intellectPoints":0,"coins":20}');
        const completedProblems = JSON.parse(localStorage.getItem('completedProblems') || '[]');
        const ownedItems = JSON.parse(localStorage.getItem('ownedItems') || '{"glasses":false,"hat":false,"goldBackground":false,"superCostume":false}');

        // Populate user info
        if (user.fullName) {
            document.getElementById('user-fullname').textContent = user.fullName;
            document.getElementById('edit-fullname').value = user.fullName;
        }
        if (user.email) {
            document.getElementById('edit-email').value = user.email;
        }
        if (user.phone) {
            document.getElementById('edit-phone').value = user.phone;
        }
        if (user.school) {
            document.getElementById('user-school').textContent = user.school;
            document.getElementById('edit-school').value = user.school;
        }
        if (user.city) {
            document.getElementById('edit-city').value = user.city;
        }
        if (user.grade) {
            document.getElementById('edit-grade').value = user.grade;
        }

        // Set avatar image
        const avatar = localStorage.getItem('avatar') || 'bektur';
        const avatarImages = {
            'bektur': '../assets/images/bektur.jpg',
            'nazym': '../assets/images/nazym.jpg'
        };
        document.getElementById('avatar-img').src = avatarImages[avatar];

        // Populate stats
        document.getElementById('stat-level').textContent = stats.level;
        document.getElementById('stat-points').textContent = stats.intellectPoints;
        document.getElementById('stat-coins').textContent = stats.coins;
        document.getElementById('stat-completed').textContent = completedProblems.length;

        // Calculate and show level progress
        const levelInfo = calculateLevel(stats.intellectPoints);
        const progressPercentage = (levelInfo.currentProgress / levelInfo.nextLevelPoints) * 100;
        document.getElementById('level-progress').style.width = `${progressPercentage}%`;
        document.getElementById('progress-text').textContent = `${levelInfo.currentProgress} / ${levelInfo.nextLevelPoints} “±–ø–∞–π`;

        // Update topic progress
        for (let i = 1; i <= 3; i++) {
            const topicId = `topic${i}`;
            const completed = completedProblems.filter(p => p.startsWith(topicId)).length;
            const percentage = (completed / 20) * 100;

            document.getElementById(`progress-count-${i}`).textContent = `${completed} / 20`;
            document.getElementById(`progress-bar-${i}`).style.width = `${percentage}%`;
        }

        // Show owned items
        const itemNames = {
            'glasses': 'üï∂Ô∏è –ö”©–∑—ñ–ª–¥—ñ—Ä—ñ–∫',
            'hat': 'üé© –ë–∞—Å –∫–∏—ñ–º',
            'goldBackground': '‚≠ê –ê–ª—Ç—ã–Ω —Ñ–æ–Ω',
            'superCostume': 'ü¶∏ –°—É–ø–µ—Ä –∫–æ—Å—Ç—é–º'
        };

        const ownedItemsList = Object.keys(ownedItems).filter(key => ownedItems[key]);
        if (ownedItemsList.length > 0) {
            let itemsHTML = '<div class="owned-items-list">';
            ownedItemsList.forEach(item => {
                itemsHTML += `<div class="owned-item">${itemNames[item]}</div>`;
            });
            itemsHTML += '</div>';
            document.getElementById('owned-items').innerHTML = itemsHTML;
        }

        function saveProfile() {
            const updatedUser = {
                ...user,
                fullName: document.getElementById('edit-fullname').value,
                email: document.getElementById('edit-email').value,
                city: document.getElementById('edit-city').value,
                grade: parseInt(document.getElementById('edit-grade').value),
                school: document.getElementById('edit-school').value
            };

            localStorage.setItem('user', JSON.stringify(updatedUser));

            // Update display
            document.getElementById('user-fullname').textContent = updatedUser.fullName;
            document.getElementById('user-school').textContent = updatedUser.school;

            showToast('success', '–ü—Ä–æ—Ñ–∏–ª—å —Å”ô—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã!');
        }

        function changeAvatar() {
            const currentAvatar = localStorage.getItem('avatar') || 'bektur';
            const newAvatar = currentAvatar === 'bektur' ? 'nazym' : 'bektur';

            localStorage.setItem('avatar', newAvatar);
            document.getElementById('avatar-img').src = avatarImages[newAvatar];

            showToast('success', `–ê–≤–∞—Ç–∞—Ä ${newAvatar === 'bektur' ? '–ë–µ–∫—Ç“±—Ä' : '–ù–∞–∑—ã–º'} –±–æ–ª—ã–ø ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!`);
        }
    </script>
</body>

</html>